<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timed Multiplication Flash Cards</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Set default font to Inter -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        
        /* FIX for Mobile Keyboard Scrolling Issue */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh; /* Use height: 100vh instead of min-height */
            overflow-y: auto; /* Allow vertical scrolling if content is pushed */
            padding: 16px;
        }
        
        .animate-pulse-slow {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
    </style>
</head>
<body>

<!-- Timer/Game Over Overlay -->
<div id="gameOverOverlay" class="fixed inset-0 bg-black bg-opacity-80 flex justify-center items-center z-50 hidden transition-opacity duration-300">
    <!-- Updated for better mobile responsiveness: w-11/12, max-w-sm, reduced padding, responsive text sizes -->
    <div class="w-11/12 max-w-sm bg-gray-900 p-8 rounded-2xl shadow-2xl text-center border-4 border-red-500 transform scale-105">
        <p class="text-6xl md:text-9xl mb-4 animate-pulse-slow">ðŸ’¥</p>
        <h2 class="text-4xl md:text-6xl font-extrabold text-yellow-400 mb-6 tracking-wider">BOOM!</h2>
        <p class="text-lg md:text-xl text-white mb-8">The fuse ran out! Try to beat the clock next time.</p>
        <button id="restartButton"
                class="bg-yellow-400 text-gray-900 py-3 px-8 rounded-xl font-bold text-lg md:text-xl shadow-lg hover:bg-yellow-300 transition-colors duration-200 transform active:scale-95">
            Start Over
        </button>
    </div>
</div>

<!-- Global Toast Container - Fixed position, centered at the bottom of the viewport -->
<div id="toastContainer" class="fixed bottom-4 left-1/2 transform -translate-x-1/2 z-50 transition-opacity duration-300 pointer-events-none">
</div>

<div id="app" class="w-full max-w-md bg-white p-8 rounded-xl shadow-2xl transition-opacity duration-500">
    <!-- Header -->
    <h1 class="text-3xl font-extrabold text-center text-indigo-700 mb-6 tracking-tight">
        Multiplication Blitz
    </h1>

    <!-- Fuse/Progress Bar (Timer) -->
    <!-- The progress bar shrinks from right to left, towards the bomb icon on the left -->
    <div id="timerContainer" class="mb-6 h-6 bg-gray-200 rounded-full shadow-inner relative">
        
        <!-- The Progress Bar starts on the left and shrinks right to left. z-10 for layering. -->
        <div id="progressBar" 
             class="h-full absolute left-0 bg-green-500 rounded-full transition-[width] duration-[50ms] ease-linear z-10" 
             style="width: 100%;">
        </div>

        <!-- Bomb on the left end of the fuse. Using left-[-10px] to ensure it's fully visible and not clipped. z-30 for visibility. -->
        <div class="absolute left-[-10px] inset-y-0 flex items-center text-3xl pointer-events-none z-30" title="Fuse End">
            ðŸ’£
        </div>
    </div>


    <!-- Card Display Area -->
    <div class="bg-indigo-50 border-2 border-indigo-200 rounded-lg p-8 mb-6 text-center shadow-inner">
        <p id="questionDisplay" class="text-7xl font-bold text-indigo-900 select-none transition-opacity duration-500 ease-in-out">
            <!-- Question will be displayed here -->
        </p>
    </div>

    <!-- User Input and Controls -->
    <div class="space-y-4">
        <!-- Removed "Your Answer:" label to tighten spacing -->
        <input type="number" id="answerInput" placeholder="Type your answer here"
               class="w-full px-4 py-3 text-lg border-2 border-gray-300 rounded-lg focus:ring-4 focus:ring-indigo-500 focus:border-indigo-500 transition-all shadow-md"
               autofocus>

        <button id="checkButton"
                class="w-full bg-indigo-600 text-white py-3 rounded-xl font-semibold text-lg shadow-lg hover:bg-indigo-700 transition-colors duration-200 transform active:scale-98">
            Check Answer
        </button>
    </div>

    <!-- Removed feedbackContainer to tighten spacing -->
</div>

<script>
    // Constants and state
    const MIN_NUMBER = 1;
    const MAX_NUMBER = 12;
    // Timer constants and state
    const TIME_LIMIT_MS = 10000; // 10 seconds to answer
    const TIMER_INTERVAL_MS = 50; // Update every 50ms for smooth animation
    let num1, num2, correctAnswer;
    let timeLeft = TIME_LIMIT_MS;
    let timerInterval;
    let gameActive = false; // State tracker
    let incorrectTimeout; // To hold the timeout for incorrect button feedback

    // DOM Elements
    const questionDisplay = document.getElementById('questionDisplay');
    const answerInput = document.getElementById('answerInput');
    const checkButton = document.getElementById('checkButton');
    // const feedbackContainer is no longer needed
    const progressBar = document.getElementById('progressBar');
    const gameOverOverlay = document.getElementById('gameOverOverlay');
    const restartButton = document.getElementById('restartButton');
    const appContainer = document.getElementById('app');
    const toastContainer = document.getElementById('toastContainer'); // New toast element

    /**
     * Initializes a new game session.
     */
    function startGame() {
        appContainer.style.opacity = 1; // Make app visible
        gameOverOverlay.classList.add('hidden'); // Hide game over overlay
        gameActive = true;
        resetTimer();
        generateNewProblem();
    }

    /**
     * Stops the timer and shows the game over screen.
     */
    function endGame() {
        clearInterval(timerInterval);
        gameActive = false;
        gameOverOverlay.classList.remove('hidden');
        appContainer.style.opacity = 0.3; // Dim the main app area
    }

    /**
     * Resets the fuse (timer) back to full.
     */
    function resetTimer() {
        clearInterval(timerInterval);
        timeLeft = TIME_LIMIT_MS;
        // Set up the interval again
        timerInterval = setInterval(updateTimer, TIMER_INTERVAL_MS);
    }

    /**
     * Decrements the timer and updates the progress bar visualization.
     */
    function updateTimer() {
        if (!gameActive) return;

        timeLeft -= TIMER_INTERVAL_MS;

        const percentage = (timeLeft / TIME_LIMIT_MS) * 100;
        
        // Update the width of the progress bar
        progressBar.style.width = `${percentage}%`;

        // Base classes to maintain positioning and transition
        let baseClasses = 'h-full absolute left-0 rounded-full transition-[width] duration-[50ms] ease-linear z-10';

        // Update color based on remaining time
        if (percentage > 50) {
            progressBar.className = `${baseClasses} bg-green-500`;
        } else if (percentage > 20) {
            progressBar.className = `${baseClasses} bg-yellow-500`;
        } else {
            // Below 20%, it's critical (red)
            progressBar.className = `${baseClasses} bg-red-500`;
        }

        if (timeLeft <= 0) {
            endGame();
        }
    }

    /**
     * Generates a new random multiplication problem.
     */
    function generateNewProblem() {
        if (!gameActive) return;

        // Clear previous state and feedback
        answerInput.value = '';
        answerInput.disabled = false;
        checkButton.disabled = false;
        // feedbackContainer.innerHTML = ''; // Removed this, using toast instead
        answerInput.focus();

        // Generate numbers
        num1 = Math.floor(Math.random() * (MAX_NUMBER - MIN_NUMBER + 1)) + MIN_NUMBER;
        num2 = Math.floor(Math.random() * (MAX_NUMBER - MIN_NUMBER + 1)) + MIN_NUMBER;
        correctAnswer = num1 * num2;

        // Update the display
        questionDisplay.textContent = `${num1} Ã— ${num2}`;
    }

    /**
     * Displays a non-intrusive toast notification for input validation.
     * @param {string} message The text message to display.
     */
    function showToast(message) {
        // Clear any existing toast
        toastContainer.innerHTML = '';
        
        const toastHtml = `
            <div class="bg-yellow-500 text-gray-900 py-2 px-6 rounded-xl shadow-xl font-semibold text-center 
                 transform scale-100 transition-all duration-300 opacity-100">
                ${message}
            </div>
        `;
        
        toastContainer.innerHTML = toastHtml;
        
        // Auto-hide the toast after 3 seconds (3000ms)
        setTimeout(() => {
            // Find the inner toast element and hide it gracefully
            const toast = toastContainer.querySelector('div');
            if(toast) {
                toast.classList.add('opacity-0');
                // Remove from DOM after transition
                setTimeout(() => toastContainer.innerHTML = '', 300); 
            }
        }, 3000);
    }

    /**
     * Handles the user checking their answer.
     */
    function checkAnswer() {
        // Prevent double clicks while processing
        if (checkButton.disabled) return;
        
        const userAnswer = parseInt(answerInput.value, 10);

        // Input validation - now uses the non-layout-affecting toast
        if (isNaN(userAnswer) || answerInput.value === '') {
            showToast('Please enter a number.');
            return;
        }
        
        // --- Correct Answer Flow ---
        if (userAnswer === correctAnswer) {
            resetTimer();
            generateNewProblem();
            return; // Exit, game continues immediately
        }

        // --- Incorrect Answer Flow ---
        
        // 1. Set temporary button state for incorrect feedback
        clearTimeout(incorrectTimeout); // Clear any existing timeout
        
        const originalText = 'Check Answer';
        
        checkButton.textContent = 'âŒ Incorrect. Try again!';
        checkButton.disabled = true; // Disable button during feedback
        // Input remains active, allowing the user to change their answer immediately

        // Change color to red
        checkButton.classList.remove('bg-indigo-600', 'hover:bg-indigo-700');
        checkButton.classList.add('bg-red-500', 'hover:bg-red-600');

        // 2. Revert state after 1 second (1000ms)
        incorrectTimeout = setTimeout(() => {
            checkButton.textContent = originalText;
            checkButton.disabled = false; // Re-enable button
            answerInput.value = ''; // Clear the incorrect answer for a new attempt
            answerInput.focus();

            // Change color back to indigo
            checkButton.classList.remove('bg-red-500', 'hover:bg-red-600');
            checkButton.classList.add('bg-indigo-600', 'hover:bg-indigo-700');
        }, 1000); 

        // Fuse keeps burning since resetTimer() was not called
    }

    /**
     * Event listeners setup.
     */
    checkButton.addEventListener('click', checkAnswer);
    restartButton.addEventListener('click', startGame);

    // Allow pressing Enter key to check
    answerInput.addEventListener('keydown', function(event) {
        if (event.key === 'Enter' && gameActive) {
            checkAnswer();
            event.preventDefault(); // Prevent default form submission behavior
        }
    });

    // Start the application
    window.onload = startGame;
</script>
</body>
</html>
